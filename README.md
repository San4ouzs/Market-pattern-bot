# Telegram-бот: поиск похожих графиков рынков

Этот бот анализирует графики изменения цен и объёмов для:
- Биткоина и других криптовалют
- Национальных валют (Forex)
- Биржевых индексов
- Сырьевых активов (commodities)
- Акций крупных компаний

И по запросу в Telegram:
- Находит активы с **похожим** движением цены
- Находит активы с **обратным** (инверсным) движением
- Строит и отправляет сравнительные графики в чат

## Структура команд

### /find_like

Ищет активы с похожим движением цены.

**Формат:**
`/find_like <ТИКЕР> <ТАЙМФРЕЙМ> <ДНЕЙ>`

**Примеры:**
- `/find_like BTC-USD 1d 90`
- `/find_like ETH-USD 4h 30`
- `/find_like ^GSPC 1d 365`

### /find_inverse

Ищет активы с обратной (инверсной) динамикой.

**Формат:**
`/find_inverse <ТИКЕР> <ТАЙМФРЕЙМ> <ДНЕЙ>`

**Пример:**
- `/find_inverse BTC-USD 1d 90`

### Таймфреймы

Поддерживаются таймфреймы Yahoo Finance:

- `1m`, `5m`, `15m`, `30m`
- `60m` или `1h`
- `4h`
- `1d`
- `1wk` (`1w`)
- `1mo`

### Примеры тикеров (Yahoo Finance)

- Крипто: `BTC-USD`, `ETH-USD`, `BNB-USD`, `SOL-USD`, `ADA-USD`
- Forex: `EURUSD=X`, `GBPUSD=X`, `USDJPY=X`, `USDRUB=X`, `USDCHF=X`
- Индексы: `^GSPC`, `^NDX`, `^DJI`, `^RUT`, `^STOXX50E`, `^GDAXI`
- Сырьё: `GC=F` (золото), `SI=F` (серебро), `CL=F` (WTI), `BZ=F` (Brent), `NG=F` (газ)
- Акции: `AAPL`, `MSFT`, `GOOGL`, `AMZN`, `TSLA`, `META`

Вы можете использовать и любые другие тикеры Yahoo Finance — бот попытается их скачать. Для поиска похожих/обратных движений используется заготовленный список UNIVERSE внутри `main.py`, который можно расширять.

## Установка и запуск

1. Установите Python 3.10+.

2. Скачайте архив проекта и распакуйте.

3. Внутри папки проекта создайте виртуальное окружение (по желанию):

```bash
python -m venv venv
source venv/bin/activate   # Linux/macOS
venv\Scripts\activate    # Windows
```

4. Установите зависимости:

```bash
pip install -r requirements.txt
```

5. Создайте файл `.env` (можно скопировать из `.env.example`) и вставьте токен вашего Telegram-бота:

```env
TELEGRAM_BOT_TOKEN=ВАШ_ТОКЕН_ОТ_BotFather
```

6. Запустите бота:

```bash
python main.py
```

7. Откройте ваш бот в Telegram и отправьте команды:

- `/start`
- `/help`
- `/find_like BTC-USD 1d 90`
- `/find_inverse BTC-USD 1d 90`

## Как это работает (логика анализа)

1. По вашей команде бот:
   - считывает базовый тикер, таймфрейм и период в днях;
   - через Yahoo Finance загружает исторические данные (OHLCV) для базового актива и набора универса активов (крипто, валюты, индексы, сырьё, акции).

2. Для каждого актива:
   - приводятся временные ряды к общему времени;
   - считаются логарифмические доходности по цене закрытия;
   - считается корреляция доходностей (corr_price);
   - отдельно считается корреляция изменения объёмов (corr_volume).

3. В режиме:
   - **/find_like** — сортировка по максимальной положительной корреляции (самые похожие движения);
   - **/find_inverse** — сортировка по самым отрицательным значениям корреляции (обратные движения).

4. Для top-N (по умолчанию 5) бот строит сравнительные графики:
   - цена каждого актива нормируется к 100 в начале периода;
   - на одном графике две линии: базовый актив и сравниваемый;
   - в заголовке указываются corr_price и corr_volume.

Вы можете адаптировать этот пример под свои задачи:
- расширить список UNIVERSE;
- добавить Excel-выгрузку;
- подключить другие источники данных помимо Yahoo Finance;
- добавить фильтры по категориям активов.
